
-- 가견적서
CREATE TABLE `proforma` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '아이디',
  `proforma_key` varchar(30) NOT NULL COLLATE utf8mb4_unicode_ci COMMENT '가견적키',
  `proforma_number` varchar(30) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '가견적서 번호',
  `role_id` int(10) unsigned NOT NULL DEFAULT 2,
  `user_id` int(10) unsigned NOT NULL,
  `admin_user_id` int(10) unsigned NOT NULL DEFAULT 0 COMMENT '관리자 아이디',
  `operator_user_id` int(10) unsigned DEFAULT NULL COMMENT 'PO 아이디',
  `manager` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `operator` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `pr_type` int(10) DEFAULT NULL COMMENT '상품 종류 수',
  `total_price` decimal(10,2) NOT NULL,
  `subtotal_price` decimal(10,2) NOT NULL COMMENT 'subtotal',
  `shipping_price` decimal(10,2) NOT NULL COMMENT '총액',
  `total_quantity` decimal(10,2) NOT NULL COMMENT '총액',
  `total_weight` decimal(10,2) unsigned NOT NULL DEFAULT 0.00,
  `recipient_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '수신자 이름 ',
  `phone` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '배송지 전화번호',
  `ct_id` char(2) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '배송지국가코드',
  `cs_id` char(2) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '회사주코드',
  `city` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '배송지 도시',
  `address1` varchar(512) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '배송지 주소 1',
  `address2` varchar(512) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '배송지 주소 2',
  `zipcode` varchar(10) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '배송지 우편번호',
  `incoterms` char(3) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '인코텀스 ',
  `shipment_service_id` int(10) unsigned NOT NULL DEFAULT 0 COMMENT '배송 서비스 아이디',
  `est_ship_date` int(10) unsigned NOT NULL DEFAULT 0 COMMENT '예상 배송일',
  `comments` text COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '리마크',
  `order_placed` int(10) NOT NULL DEFAULT 0 COMMENT '주문 상태값',
  `status` tinyint(1) NOT NULL DEFAULT 0 COMMENT '상테값',
  `status_updated` timestamp NULL DEFAULT NULL COMMENT '상태변경일시',
  `approved` tinyint(1) NOT NULL DEFAULT 0 COMMENT '승인값',
  `approved_date` timestamp NULL DEFAULT NULL COMMENT '승인일시',
  `created` timestamp NULL DEFAULT current_timestamp() COMMENT '생성날짜',
  `updated` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp() COMMENT '수정일시',
  `deleted` timestamp NULL DEFAULT NULL COMMENT '삭제날짜',
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_proforma_key` (`proforma_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 가견적서 상품
CREATE TABLE `proforma_product` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT '아이디',
  `proforma_key` varchar(30) NOT NULL COLLATE utf8mb4_unicode_ci COMMENT '가견적키',
  `user_id` int(10) unsigned NOT NULL COMMENT '사용자 아이디',
  `proforma_id` int(10) unsigned NOT NULL COMMENT '가견적서 아이디',
  `br_id` int(10) unsigned NULL DEFAULT NULL COMMENT '브랜드 아이디',
  `pr_id` int(10) unsigned NOT NULL COMMENT '상품 아이디',
  `br_name` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '브랜드명',
  `pr_name` varchar(512) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '상품명',
  `po_id` int(10) unsigned NOT NULL DEFAULT 0 COMMENT '상품 옵션 아이디',
  `po_name` varchar(45) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '상품 옵션명',
  `images` longtext COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT '[]' COMMENT '상품 이미지',
  `discount_id` int(10) unsigned DEFAULT NULL,
  `total_price` decimal(10,2) GENERATED ALWAYS AS (`supply_price` * `quantity`) STORED,
  `supply_price` decimal(10,2) DEFAULT NULL COMMENT '공급가',
  `retail_price` decimal(10,2) DEFAULT NULL COMMENT '소매가',
  `supply_rate` decimal(10,2) DEFAULT NULL COMMENT '공급률',
  `capacity` decimal(10,2) DEFAULT NULL COMMENT '용량',
  `capacity_type` char(1) DEFAULT NULL COMMENT '용량타입',
  `quantity` int(10) unsigned NOT NULL DEFAULT 1 COMMENT '상품 수량',
  `status` tinyint(1) NOT NULL DEFAULT 1,
  `created` timestamp NULL DEFAULT current_timestamp() COMMENT '생성일시',
  `updated` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp() COMMENT '수정일시',
  `deleted` timestamp NULL DEFAULT NULL COMMENT '삭제일시',
  PRIMARY KEY (`id`),
  UNIQUE KEY `unq_pp_ids` (`proforma_key`,`pr_id`,`po_id`),
  KEY `idx_pp_proforma_id` (`proforma_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='가견적서 상품'
